命令简介
======= 

`www buy` 用来生购买商品的订单

根据传入的 `-site id:xxx` 可获得站点信息。
本次操作需要站点主目录元数据提供如下映射信息

```js
accounts  : "~/accounts",   // 【必】用户库路径
orders    : "~/orders",     // 【必】订单库路径
products  : "~/products",   // 【必】商品库路径
coupons   : "~/coupons",    // 优惠券库路径

// 微信配置目录名称，该目录位于 ~/.weixin/ 目录下
// 微信登录，公众号消息推送，微信支付等功能均在这个目录下配置
// 当支付类型为 `wx.` 时需要这个配置项目
weixin : "theName"

// 支付宝配置目录名称，该目录位于 ~/.alipay/ 目录下
// 支付宝支付等功能均在这个目录下配置
// 当支付类型为 `zfb.` 时需要这个配置项目
alipay : "theName"
```

**限制条件**

- 如果是微信公众号支付，则需要账户里有 `openid` 以便主动调起 `JSSDK` 

**注意**

本命令只会生成订单（在用户域中），真正支付需要创建系统支付单，
由 `www pay` 命令根据订单信息调用 `pay` 命令创建并发送一个真正的系统支付单

返回结果
=======

命令返回的是一个订单的 JSON数据，格式如下：

```js
id: ID,        // 订单唯一ID
//-----------------------------
// 基本信息
products: [{   // 商品列表
  id,
  title,
  price,
  amount
}],
coupons: [{    // 优惠券列表
  id,
  title,
  type,
  value,
  thres,
  expi
}]
//-----------------------------
// 买家信息
accounts : ID        // 买家用户库
buyer_id : ID        // 买家ID
//-----------------------------
// 支付信息
ptype  : "wx.qrcode"  // 支付类型
price  : 321.56       // 订单金额
fee    : 319.12       // 优惠后金额
pay_id : ID           // 支付单ID 
//-----------------------------
// 状态信息
//  - NW : 新建
//  - WT : 等待支付（已经关联了支付单）
//  - OK : 买家已经支付成功
//  - FA : 买家已经支付失败
//  - SD : 卖家已发货
//  - DN : 订单完成
status : "NW"
//-----------------------------
// 时间戳
ct : AMS      // 创建时间
lm : AMS      // 最后变动时间
wt_at : AMS    // 创建支付单时间
ok_at : AMS    // 买家支付成功时间
fa_at : AMS    // 买家支付失败时间
sd_at : AMS    // 卖家已发货时间
dn_at : AMS    // 订单完成时间
```

用法
=======

```bash
www buy
    [ID0 ID1 ..]       # 【必】商品的ID列表
    [-site id:xxx]     # 【必】站点主目录路径，
                       # 主目录必须设置了orders(订单库)/products(商品库)
                       # 以便进行服务器校验。数据集均为 Thing
    [-u $ticket]       # 【必】用户登录票据
    [-ptype wx.qrcode] # 【必】订单的支付类型
    [-brief xxx]       # 订单摘要，默认会根据其他参数默认生成
    [-coupon ID0,ID1]  # 优惠券ID，半角逗号分隔表示多个
                       # 如果有这个选项，则需要主目录设置了 
                       # coupons(优惠券库） ，否则抛错
    #-----------------------------------------------
    # 输出的JSON数据的配置信息
    [-cqn]           # JSON 输出的格式化方式
    [-ajax]          # 开启这个选项，则输出为 ajaxReturn 的包裹
```

> 如果是没有指定 `-brief` 命令自动生成的话，其内容就是支付商户的名称

示例
=======

```bash
# 创建一个微信支付的订单
www buy $ID0 -site id:xxx -u TICKET -ptype wx.qrcode
```