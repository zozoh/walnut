# 命令简介 

`thing copy` 将指定的数据记录复制为多份。
可以是复制到指定目标记录，也可以是`N`个新记录

**!注意** 如果`thing`包括唯一键，在复制的时候，默认会被无视，否则会引起唯一键冲突。

# 用法

```bash
thing [TsID] duplicate 
  ID                  # 源记录ID
  [10]                # 【选1】复制的份数。如果指定了 -to 则无视这个参数
                      # 否则默认为 1
  #--------------------------------------------------------
  [-to ID1,ID2...]    # 【选1】目标记录ID,多个记录用半角逗号分隔
  [-tokey id]         # 指定目标记录的ID对应的键名，默认为"id"
                      # 这个参数可以更换为别的唯一键
  [-fields REGEX]     # 一个正则表达式表示要复制哪些字段
  [-shallow]          # 浅层复制。表示如果记录是文件，只是复制引用
                      # 否则会将文件也复制一份
  [-meta {..}]        # 指定所有对象都固定覆盖设置的元数据
  #--------------------------------------------------------
  [-copy 'F1,F2..']   # 一个半角逗号分隔的路径列表，表示复制的时候
                      # 还要固定的复制哪些文件
  #--------------------------------------------------------
  # 下面三个参数，仅仅在深层复制模式下（即 -shallow 未开启）起作用
  # 即，一条记录引用了某文件，但是这个文件是在集合外的全局引用
  # 如果复制记录，是不是也要顺便复制这个全局引用呢？ 如果未指定下面的参数
  # 则不会复制（也就是回退到了浅层复制）
  [-foutside REGEX]   # 一个匹配文件名的正则表达式，可以为 fvars 提供上下文变量
  [-fmatch-only]      # 表示只有匹配上正则的，才会深层复制
  [-fvars {..}]       # 一个可 Explain 的JSON对象，补充给 fnewname 渲染上下文
                      # 这个对象被 Explain 时的上下文来与 fnewname 的一致，它的渲染结果
                      # 会补充到上下文中（最高优先级），以备 fnewname 渲染使用
                      #  1. 正则表达式 g0...gN
                      #  2. 一个固定的上下文变量 input，表示文件名
                      #  3. 目标记录的所有元数据 `target.xxx`
                      #  4. 源记录所有的元数据 `file.xxx`
                      # 上述上下文变量优先级是从高到低的，即 1 为最高优先级
                      # 如果并未声明这个参数，则直接使用原始的上下文变量
  [-fnewname TMPL]    # 一个字符串模板，表示复制后文件的新名称
                      # 默认的，字符串模板为 "${id}-${name?@input}"
  [-fflds REGEX]      # 当复制文件时，要 Copy 的字段
  [-fmeta {..}]       # 一个可 Explain 的JSON对象，提供复制文件时，要固定增加的字段，
                      # 渲染上下文为 -fvars
  #--------------------------------------------------------
  [-obj]              # 查询列表如果是多个，则只输出第一个对象，如果列表为空，则返回 null
  [-cqn]              # JSON 格式化方式

```

# 示例

```bash
# 将一个记录深层复制一份
thing ~/demo duplicate 4e8..9a3

# 将一个记录深层复制10份
thing ~/demo duplicate 4e8..9a3 10

# 将一个记录全部信息浅层复制到指定的两个记录上
thing ~/demo duplicate 4e8..9a3 -to "8a..9q,g1..he" -cqn -shallow

# 将一个记录深层复制到另外一个记录上，对于集合外数据也深层复制
# 同时复制集合内数据文件 test/setup.json
thing ~/demo duplicate 4e8..9a3 \
   -foutside '^([0-9a-v]{26}(:([^-]+))?)-([A-Z0-9]+)-(.+)$' \
   -fvars '{tp:"=g4?AP", name:"=g5?@input"}' \
   -fnewname '${id}-${tp}-${name}' \
   -copy test/setup.json
```