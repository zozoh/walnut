---
title:数据同步
author:wendal
tags:
- 系统
- 扩展
---

# 数据同步

本地数据源(通常是个文件夹)与walnut的数据双向同步操作

## 同步的级别

* 第一级 基于文件树的基本操作(增/删/覆盖)
* 第二级 增加syncTime支持
* 第三级 覆盖操作改成二进制差分更新(貌似有git的味道)

## 冲突解决

* 强制覆盖(-f)
* 另存为临时文件

## 单次完整同步

* 客户端发起同步请求
	* 根目录
	* 本地目录树
		* 文件列表
		* 文件的修改时间及其他元数据
* 服务器端返回
	* 远程目录树
		* 文件列表
		* 文件的修改时间及其他元数据
		
* 客户端计算出目录树差异
* 遍历差异,逐一调用增删改的API


